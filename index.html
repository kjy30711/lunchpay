<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì›”ë§ ì ì‹¬ê°’ ê³„ì‚°ê¸°</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 600px;
    margin: 40px auto;
    padding: 0 10px;
  }
  h1 { text-align: center; }
  input, button { padding: 6px; margin: 4px; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { border: 1px solid #ddd; padding: 2px; text-align: center; }
  th { background: #f2f2f2; }

  /* ëª¨ë°”ì¼ ì „ìš© ìŠ¤íƒ€ì¼ */
  @media (max-width: 768px) {
    body {
      max-width: 100%;
      margin: 0;
      padding: 10px;
    }

    h1 { font-size: 1.5em; }

    input, button {
      width: 100%;
      font-size: 1.2em;
      padding: 12px;
      margin: 6px 0;
    }

    .flex-row {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .table-container {
      overflow-x: auto;
    }
  }
</style>
</head>
<body>

<div id="app">

<h1>ğŸ± ì›”ë§ ì ì‹¬ê°’ ê³„ì‚°ê¸°</h1>

<div class="flex-row">
  <input type="number" id="price" onfocus="this.select()" placeholder="ê¸°ë³¸ ì ì‹¬ê°’" />
  <button onclick="savePrice()" tabindex="-1">ì €ì¥</button>
</div>

<div class="flex-row">
  <input type="text" id="nameInput" placeholder="ì´ë¦„" onkeydown="handleEnter(event)">
  <button onclick="addPerson()" tabindex="-1">ì¶”ê°€</button>
  <button onclick="resetAll()" tabindex="-1">ì „ì²´ ì´ˆê¸°í™”</button>
  <button onclick="copyResult()" tabindex="-1">ë³µì‚¬</button>
</div>

<div class="table-container">
  <table>
    <thead>
      <tr>
        <th>ì´ë¦„</th>
        <th>ë¨¹ì€ íšŸìˆ˜</th>
        <th>ì›” ì ì‹¬ê°’</th>
        <th>ì‚­ì œ</th>
      </tr>
    </thead>
    <tbody id="list"></tbody>
  </table>
</div>

</div>

<script>
// JSëŠ” ê¸°ì¡´ ì½”ë“œ ê·¸ëŒ€ë¡œ ì‚¬ìš©
let people = JSON.parse(localStorage.getItem("people")) || [];
let price = Number(localStorage.getItem("price")) || 6000;
document.getElementById("price").value = price;

function handleEnter(e) {
  if (e.key === "Enter") addPerson();
}

function savePrice() {
  price = Number(document.getElementById("price").value) || 0;
  localStorage.setItem("price", price);
  updateTotalsOnly();
}

function addPerson() {
  const name = document.getElementById("nameInput").value.trim();
  if (!name) return alert("ì´ë¦„ ì…ë ¥í•˜ì„¸ìš”");
  people.push({ name, count: 0 });
  document.getElementById("nameInput").value = "";
  saveAll();
}

function removePerson(index) {
  people.splice(index, 1);
  saveAll();
}

function resetAll() {
  if (!confirm("ëª¨ë“  ëª©ë¡ê³¼ íšŸìˆ˜ë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”?")) return;
  people = [];
  localStorage.removeItem("people");
  render();
}

function saveAll() {
  localStorage.setItem("people", JSON.stringify(people));
  render();
}

function formatWon(num) {
  return num.toLocaleString("ko-KR") + "ì›";
}

function render() {
  const tbody = document.getElementById("list");
  tbody.innerHTML = "";
  people.forEach((p, i) => {
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${p.name}</td>
      <td>
        <input 
          type="number"
          min="0"
          step="1"
          inputmode="numeric"
          pattern="[0-9]*"
          value="${p.count}" 
          data-index="${i}"
          onfocus="this.select()"
        >
      </td>
      <td class="total">${formatWon(p.count * price)}</td>
      <td><button tabindex="-1">ì‚­ì œ</button></td>
    `;

    tr.querySelector("button").onclick = () => removePerson(i);
    tbody.appendChild(tr);
  });
}

document.getElementById("list").addEventListener("input", function(e) {
  if (e.target.tagName !== "INPUT") return;
  const idx = Number(e.target.dataset.index);

  let raw = e.target.value;
  raw = raw.replace(/[^0-9]/g, '');
  raw = raw.replace(/^0+(?=\d)/, '');

  const val = raw === "" ? 0 : Number(raw);
  e.target.value = val;

  people[idx].count = val;
  localStorage.setItem("people", JSON.stringify(people));
  updateTotalsOnly();
});

function updateTotalsOnly() {
  document.querySelectorAll("#list tr").forEach((tr, i) => {
    const totalCell = tr.querySelector(".total");
    totalCell.textContent = formatWon(people[i].count * price);
  });
}

document.getElementById("list").addEventListener("keydown", function(e) {
  if (e.key !== "Tab" && e.key !== "Enter") return;

  const inputs = Array.from(document.querySelectorAll('#list input[type="number"]'));
  const current = document.activeElement;
  const idx = inputs.indexOf(current);

  if (idx === -1) return;

  e.preventDefault();

  if (e.shiftKey && e.key === "Tab") {
    const prev = idx === 0 ? inputs.length - 1 : idx - 1;
    inputs[prev].focus();
  } else {
    const next = idx === inputs.length - 1 ? 0 : idx + 1;
    inputs[next].focus();
  }
});

function copyResult() {
  if (people.length === 0) {
    alert("ë³µì‚¬í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }

  const now = new Date();
  const year = now.getFullYear();
  const month = now.getMonth() + 1;
  const title = `${year}ë…„ ${month}ì›” ì •ì‚°`;

  const lines = people.map(p => {
    const total = p.count * price;
    return `${p.name} ${price} * ${p.count} = ${total.toLocaleString("ko-KR")}ì›`;
  });

  const resultText = [title, ...lines].join("\n");

  navigator.clipboard.writeText(resultText).then(() => {
    alert("ì›” ì •ì‚° ë‚´ì—­ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
  }).catch(() => {
    alert("ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ê¶Œí•œì„ í™•ì¸í•˜ì„¸ìš”.");
  });
}

render();
</script>

</body>
</html>
