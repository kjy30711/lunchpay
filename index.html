<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>ì›”ë§ ì ì‹¬ê°’ ê³„ì‚°ê¸°</title>

<style>
  /* ğŸ’» PC ê¸°ë³¸ ë””ìì¸ ìœ ì§€ */
  body { 
    font-family: Arial; 
    max-width: 600px; 
    margin: 40px auto; 
  }

  h1 { text-align: center; }

  input, button { 
    padding: 6px; 
    margin: 4px; 
    font-size: 14px;
    box-sizing: border-box;
  }

  table { 
    width: 100%; 
    border-collapse: collapse; 
    margin-top: 20px; 
  }

  th, td { 
    border: 1px solid #ddd; 
    padding: 2px; 
    text-align: center; 
    word-break: keep-all;
  }

  th { background: #f2f2f2; }

  /* ğŸ“± ëª¨ë°”ì¼ ì „ìš© ìë™ ì¡°ì ˆ */
  @media (max-width: 768px) {
    body {
      max-width: 100%;
      margin: 0;
      padding: 12px;
    }

    h1 {
      font-size: 20px;
      margin: 10px 0;
    }

    input, button {
      padding: 10px;
      font-size: 16px;
      margin: 4px 0;
      width: 100%;
    }

    /* âœ… ê¸°ë³¸ ì ì‹¬ê°’ ì…ë ¥í¼ + ë²„íŠ¼ ì„¸ë¡œ ë°°ì¹˜ */
    #price {
      width: 100%;
    }

    /* ë²„íŠ¼ë“¤ë„ ì¤„ë°”ê¿ˆ */
    #app > button {
      width: 100%;
    }

    table {
      table-layout: fixed;
      font-size: 14px;
    }

    th, td {
      padding: 6px 4px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    th:nth-child(1), td:nth-child(1) { width: 22%; }
    th:nth-child(2), td:nth-child(2) { width: 26%; }
    th:nth-child(3), td:nth-child(3) { width: 32%; }
    th:nth-child(4), td:nth-child(4) { width: 20%; }

    td input[type="number"] {
      width: 100%;
      min-width: 0;
    }
  }
</style>
</head>
<body>

<div id="app">

<h1>ğŸ± ì›”ë§ ì ì‹¬ê°’ ê³„ì‚°ê¸°</h1>

ê¸°ë³¸ ì ì‹¬ê°’:
<input type="number" id="price" onfocus="this.select()" onkeydown="handlePriceEnter(event)" inputmode="numeric" pattern="[0-9]*" /> ì›
<button onclick="savePrice()" tabindex="-1">ì €ì¥</button>

<hr>

ì´ë¦„ ì¶”ê°€:
<input type="text" id="nameInput" placeholder="ì´ë¦„" onkeydown="handleEnter(event)">
<button onclick="addPerson()" tabindex="-1">ì¶”ê°€</button>
<button onclick="resetAll()" tabindex="-1">ì „ì²´ ì´ˆê¸°í™”</button>
<button onclick="copyResult()" tabindex="-1">ë³µì‚¬</button>

<table>
  <thead>
    <tr>
      <th>ì´ë¦„</th>
      <th>ë¨¹ì€ íšŸìˆ˜</th>
      <th>ì›” ì ì‹¬ê°’</th>
      <th>ì‚­ì œ</th>
    </tr>
  </thead>
  <tbody id="list"></tbody>
</table>

</div>

<script>
let people = JSON.parse(localStorage.getItem("people")) || [];
let price = Number(localStorage.getItem("price")) || 6000;
document.getElementById("price").value = price;

function handleEnter(e) {
  if (e.key === "Enter") addPerson();
}

function handlePriceEnter(e) {
  if (e.key !== "Enter") return;
  e.preventDefault();
  savePrice();
  document.getElementById("nameInput").focus();
}

function savePrice() {
  price = Number(document.getElementById("price").value) || 0;
  localStorage.setItem("price", price);
  updateTotalsOnly();
}

function addPerson() {
  const name = document.getElementById("nameInput").value.trim();
  if (!name) return alert("ì´ë¦„ ì…ë ¥í•˜ì„¸ìš”");
  people.push({ name, count: 0 });
  document.getElementById("nameInput").value = "";
  saveAll();
}

function removePerson(index) {
  people.splice(index, 1);
  saveAll();
}

function resetAll() {
  if (!confirm("ëª¨ë“  ëª©ë¡ê³¼ íšŸìˆ˜ë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”?")) return;
  people = [];
  localStorage.removeItem("people");
  render();
}

function saveAll() {
  localStorage.setItem("people", JSON.stringify(people));
  render();
}

function formatWon(num) {
  return num.toLocaleString("ko-KR") + "ì›";
}

function render() {
  const tbody = document.getElementById("list");
  tbody.innerHTML = "";
  people.forEach((p, i) => {
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${p.name}</td>
      <td>
        <input 
          type="number"
          min="0"
          step="1"
          inputmode="numeric"
          pattern="[0-9]*"
          value="${p.count}" 
          data-index="${i}"
          onfocus="this.select()"
        >
      </td>
      <td class="total">${formatWon(p.count * price)}</td>
      <td><button tabindex="-1">ì‚­ì œ</button></td>
    `;

    tr.querySelector("button").onclick = () => removePerson(i);
    tbody.appendChild(tr);
  });
}

document.getElementById("list").addEventListener("input", function(e) {
  if (e.target.tagName !== "INPUT") return;
  const idx = Number(e.target.dataset.index);

  let raw = e.target.value.replace(/[^0-9]/g, '').replace(/^0+(?=\d)/, '');
  const val = raw === "" ? 0 : Number(raw);
  e.target.value = val;

  people[idx].count = val;
  localStorage.setItem("people", JSON.stringify(people));
  updateTotalsOnly();
});

function updateTotalsOnly() {
  document.querySelectorAll("#list tr").forEach((tr, i) => {
    const totalCell = tr.querySelector(".total");
    totalCell.textContent = formatWon(people[i].count * price);
  });
}

document.getElementById("list").addEventListener("keydown", function(e) {
  if (e.key !== "Tab" && e.key !== "Enter") return;

  const inputs = Array.from(document.querySelectorAll('#list input[type="number"]'));
  const current = document.activeElement;
  const idx = inputs.indexOf(current);
  if (idx === -1) return;

  e.preventDefault();

  if (e.shiftKey && e.key === "Tab") {
    inputs[idx === 0 ? inputs.length - 1 : idx - 1].focus();
  } else {
    inputs[idx === inputs.length - 1 ? 0 : idx + 1].focus();
  }
});

function copyResult() {
  if (people.length === 0) {
    alert("ë³µì‚¬í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }

  const now = new Date();
  const year = now.getFullYear();
  const month = now.getMonth() + 1;
  const title = `${year}ë…„ ${month}ì›” ì •ì‚°`;

  const lines = people.map(p => {
    const total = p.count * price;
    return `${p.name} ${price} * ${p.count} = ${total.toLocaleString("ko-KR")}ì›`;
  });

  const resultText = [title, ...lines].join("\n");

  navigator.clipboard.writeText(resultText).then(() => {
    alert("ì›” ì •ì‚° ë‚´ì—­ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
  }).catch(() => {
    alert("ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ê¶Œí•œì„ í™•ì¸í•˜ì„¸ìš”.");
  });
}

render();
</script>

</body>
</html>
